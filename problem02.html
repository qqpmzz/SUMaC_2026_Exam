<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUMaC 문제 2 - 동전 퍼즐</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: #333;
        }

        .move-display {
            font-size: 2em;
            margin-bottom: 20px;
            color: #3498db;
            font-weight: bold;
        }

        .table-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin-bottom: 25px;
        }

        .table {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(145deg, #8B4513, #654321);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3), inset 0 2px 10px rgba(255,255,255,0.1);
            transition: transform 0.5s ease;
        }

        .cup-grid {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: grid;
            grid-template-columns: repeat(2, 80px);
            grid-template-rows: repeat(2, 80px);
            gap: 20px;
        }

        .cup {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
            box-shadow: inset 0 4px 10px rgba(0,0,0,0.5), 0 2px 5px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .coin {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: default;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            border: 3px solid #888;
        }

        .coin.heads {
            background: linear-gradient(145deg, #ffffff, #e0e0e0);
            color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .coin.tails {
            background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
            color: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .coin.hidden {
            background: linear-gradient(145deg, #666, #444);
            color: transparent;
            cursor: default;
        }

        .coin.visible {
            cursor: pointer;
        }

        .coin.visible:hover {
            transform: scale(1.1);
        }

        .coin.flipping {
            animation: flip 0.3s ease;
        }

        @keyframes flip {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0deg); }
        }

        .highlight {
            box-shadow: 0 0 15px 5px #3498db, inset 0 4px 10px rgba(0,0,0,0.5);
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 15px;
        }

        .btn {
            padding: 12px 20px;
            font-size: 1em;
            border: 1px solid #333;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            background: #fff;
            color: #333;
            min-width: 100px;
        }

        .btn:hover:not(:disabled) {
            background: #333;
            color: #fff;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.active {
            background: #3498db;
            color: #fff;
            border-color: #3498db;
        }

        .btn.spin-btn {
            background: #e74c3c;
            color: #fff;
            border-color: #e74c3c;
        }

        .btn.spin-btn:hover:not(:disabled) {
            background: #c0392b;
        }

        .win-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .win-overlay.show {
            display: flex;
        }

        .win-message {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
        }

        .win-message h2 {
            color: #27ae60;
            font-size: 2em;
            margin-bottom: 15px;
        }

        .win-message p {
            color: #666;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="move-display">이동 횟수: <span id="moves">0</span></div>

    <div class="table-container">
        <div class="table" id="table">
            <div class="cup-grid" id="cup-grid">
                <div class="cup" data-index="0">
                    <div class="coin hidden" data-index="0">H</div>
                </div>
                <div class="cup" data-index="1">
                    <div class="coin hidden" data-index="1">H</div>
                </div>
                <div class="cup" data-index="2">
                    <div class="coin hidden" data-index="2">H</div>
                </div>
                <div class="cup" data-index="3">
                    <div class="coin hidden" data-index="3">H</div>
                </div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="btn" id="btn-view-all">전체보기</button>
        <button class="btn" id="btn-view-row">인접보기</button>
        <button class="btn" id="btn-view-diag">대각선보기</button>
    </div>

    <div class="controls">
        <button class="btn spin-btn" id="btn-spin" disabled>돌리기 (R)</button>
        <button class="btn" id="btn-reset">초기화</button>
    </div>

    <div class="win-overlay" id="win-overlay">
        <div class="win-message">
            <h2>축하합니다!</h2>
            <p>모든 동전을 같은 색으로 만들었습니다!</p>
            <p>총 <span id="final-moves">0</span>번의 이동으로 성공했습니다.</p>
            <button class="btn" onclick="resetGame()">다시 하기</button>
        </div>
    </div>

    <script>
        let coins = [true, true, true, true];
        let visibleCoins = [false, false, false, false];
        let moves = 0;
        let isSpinning = false;
        let hasViewed = false;

        function init() {
            do {
                coins = [
                    Math.random() < 0.5,
                    Math.random() < 0.5,
                    Math.random() < 0.5,
                    Math.random() < 0.5
                ];
            } while (coins.every(c => c === true) || coins.every(c => c === false));

            visibleCoins = [false, false, false, false];
            moves = 0;
            isSpinning = false;
            hasViewed = false;
            render();
            updateSpinButton();
            clearHighlights();
            clearActiveButtons();
        }

        function render() {
            const coinElements = document.querySelectorAll('.coin');
            coinElements.forEach((el, idx) => {
                el.className = 'coin';

                if (visibleCoins[idx]) {
                    el.classList.add('visible');
                    if (coins[idx]) {
                        el.classList.add('heads');
                        el.textContent = 'H';
                    } else {
                        el.classList.add('tails');
                        el.textContent = 'T';
                    }
                } else {
                    el.classList.add('hidden');
                    el.textContent = '?';
                }
            });

            document.getElementById('moves').textContent = moves;
        }

        function updateSpinButton() {
            document.getElementById('btn-spin').disabled = !hasViewed;
        }

        function clearHighlights() {
            document.querySelectorAll('.cup').forEach(cup => {
                cup.classList.remove('highlight');
            });
        }

        function clearActiveButtons() {
            document.querySelectorAll('.btn').forEach(btn => {
                if (btn.id !== 'btn-spin' && btn.id !== 'btn-reset') {
                    btn.classList.remove('active');
                }
            });
        }

        function highlightCups(indices) {
            clearHighlights();
            indices.forEach(idx => {
                document.querySelector(`.cup[data-index="${idx}"]`).classList.add('highlight');
            });
        }

        function viewAll() {
            if (isSpinning) return;
            visibleCoins = [true, true, true, true];
            hasViewed = true;
            highlightCups([0, 1, 2, 3]);
            clearActiveButtons();
            document.getElementById('btn-view-all').classList.add('active');
            render();
            updateSpinButton();
            checkWin();
        }

        function viewRow() {
            if (isSpinning) return;
            // 인접 쌍: 가로 [0,1], [2,3] + 세로 [0,2], [1,3]
            const adjacentPairs = [
                { visible: [true, true, false, false], highlight: [0, 1] },   // 상단 가로
                { visible: [false, false, true, true], highlight: [2, 3] },   // 하단 가로
                { visible: [true, false, true, false], highlight: [0, 2] },   // 좌측 세로
                { visible: [false, true, false, true], highlight: [1, 3] }    // 우측 세로
            ];
            const selected = adjacentPairs[Math.floor(Math.random() * 4)];
            visibleCoins = selected.visible;
            highlightCups(selected.highlight);
            hasViewed = true;
            clearActiveButtons();
            document.getElementById('btn-view-row').classList.add('active');
            render();
            updateSpinButton();
            checkWin();
        }

        function viewDiagonal() {
            if (isSpinning) return;
            const useMain = Math.random() < 0.5;
            if (useMain) {
                visibleCoins = [true, false, false, true];
                highlightCups([0, 3]);
            } else {
                visibleCoins = [false, true, true, false];
                highlightCups([1, 2]);
            }
            hasViewed = true;
            clearActiveButtons();
            document.getElementById('btn-view-diag').classList.add('active');
            render();
            updateSpinButton();
            checkWin();
        }

        function flipCoin(idx) {
            if (!visibleCoins[idx] || isSpinning) return;

            const coinEl = document.querySelector(`.coin[data-index="${idx}"]`);
            coinEl.classList.add('flipping');

            setTimeout(() => {
                coins[idx] = !coins[idx];
                render();
                coinEl.classList.remove('flipping');
                checkWin();
            }, 150);
        }

        function spin() {
            if (isSpinning || !hasViewed) return;

            isSpinning = true;
            moves++;

            visibleCoins = [false, false, false, false];
            clearHighlights();
            clearActiveButtons();
            render();

            const table = document.getElementById('table');
            const rotations = Math.floor(Math.random() * 4);
            const visualRotation = 360 + rotations * 90 + Math.random() * 720;

            setTimeout(() => {
                table.style.transform = `rotate(${visualRotation}deg)`;
            }, 100);

            setTimeout(() => {
                if (rotations > 0) {
                    const newCoins = [...coins];
                    for (let i = 0; i < 4; i++) {
                        const mapping = [1, 3, 0, 2];
                        let targetIdx = i;
                        for (let r = 0; r < rotations; r++) {
                            targetIdx = mapping[targetIdx];
                        }
                        newCoins[targetIdx] = coins[i];
                    }
                    coins = newCoins;
                }

                table.style.transition = 'none';
                table.style.transform = 'rotate(0deg)';
                setTimeout(() => {
                    table.style.transition = 'transform 0.5s ease';
                }, 50);

                hasViewed = false;
                isSpinning = false;

                updateSpinButton();
                checkWin();
            }, 1100);
        }

        function checkWin() {
            const allHeads = coins.every(c => c === true);
            const allTails = coins.every(c => c === false);

            if (allHeads || allTails) {
                visibleCoins = [true, true, true, true];
                render();

                setTimeout(() => {
                    document.getElementById('final-moves').textContent = moves;
                    document.getElementById('win-overlay').classList.add('show');
                }, 500);
            }
        }

        function resetGame() {
            document.getElementById('win-overlay').classList.remove('show');
            init();
        }

        document.getElementById('btn-view-all').addEventListener('click', viewAll);
        document.getElementById('btn-view-row').addEventListener('click', viewRow);
        document.getElementById('btn-view-diag').addEventListener('click', viewDiagonal);
        document.getElementById('btn-spin').addEventListener('click', spin);
        document.getElementById('btn-reset').addEventListener('click', resetGame);

        document.querySelectorAll('.coin').forEach(coin => {
            coin.addEventListener('click', () => {
                const idx = parseInt(coin.getAttribute('data-index'));
                flipCoin(idx);
            });
        });

        document.addEventListener('keydown', (e) => {
            if (e.code === 'KeyR' && !e.ctrlKey) {
                e.preventDefault();
                if (hasViewed && !isSpinning) {
                    spin();
                }
            }
        });

        init();
    </script>
</body>
</html>
